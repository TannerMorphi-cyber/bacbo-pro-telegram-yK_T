<script>
const secret = prompt("Clave secreta (SECRET_HEADER):", "Tanner2025") || "Tanner2025";

function update() {
    fetch("/api/status").then(r => r.json()).then(d => {
        // Racha
        document.getElementById("streak").innerHTML = 
            d.current_streak.length > 0 ? 
            `${d.current_streak.winner} ×${d.current_streak.length}` : "Sin racha";

        // Predicción
        document.getElementById("pred").innerHTML = `<h2>${d.prediction.winner}</h2>`;
        const riskClass = d.prediction.risk === "Bajo" ? "risk-low" : 
                         d.prediction.risk === "Medio" ? "risk-med" : "risk-high";
        document.getElementById("prob").innerHTML = 
            `<span class="${riskClass}">${d.prediction.probability.toFixed(1)}% • ${d.prediction.risk}</span><br><small>${d.prediction.reason}</small>`;

        // Big Road
        let road = "";
        d.big_road.flat().forEach(w => {
            road += `<div class="bead ${w}">P</div>`;
        });
        document.getElementById("bigroad").innerHTML = road || "Sin manos registradas";
    }).catch(err => console.log("Error actualización:", err));
}

function sendNow() {
    fetch("/send_signal", {
        method: "POST",
        headers: {"X-Secret": secret}
    }).then(() => alert("Señal enviada a Telegram!")).catch(err => alert("Error: " + err));
}

function saveStrategy() {
    const input = document.getElementById("strategyInput").value.trim();
    if (!input) return alert("Escribe una estrategia");
    try {
        const strat = JSON.parse(input);
        fetch("/api/strategy", {
            method: "POST",
            headers: {"X-Secret": secret, "Content-Type": "application/json"},
            body: JSON.stringify(strat)
        }).then(() => {
            alert("Estrategia guardada y activada!");
            document.getElementById("strategyInput").value = "";
        });
    } catch(e) {
        alert("JSON inválido");
    }
}

// Actualiza cada 4 segundos
setInterval(update, 4000);
update();
</script>
